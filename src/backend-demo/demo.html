<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>Пример взаимодействия с бэкендом</title>
</head>
<body>
<style>
    body {font-family: Arial; font-size: 16px; line-height: 1.5;}
    b {font-family: monospace;}
</style>
<!-- подключаем скрипт для работы с бэкендом: он сохраняет, загружает и удаляет жалобы -->
<script src="./backender.js"></script>
<!-- и ниже, прямо тут я покажу примеры работы с ним -->

<script>
    /*
    ==================================================
        1. Пример сохранения жалобы
    ==================================================
    */
    function demoAddPetition() {

        // сначала нам нужно подготовить объект, который будет отправлен в бэкенд,
        // вот пример объекта:

        const petition = {
            TEXT: 'Издалека долго<br>Течет река Волга<br>Течет река Волга<br>Конца и края нет',  // текст стиха
            POET: 'Лев ошанин',                 // поэт
            AUTHOR_NAME: 'Анатолий Пупкин',     // имя автора жалобы
            AUTHOR_EMAIL: 'demo@email.ru',      // емейл автора жалобы
            AUTHOR_TEL: '+7 (123) 456-78-90',   // телефон автора жалобы
            ADDRESS: 'Москва, ул. Ленина, д. 1',// адрес
            ADDRESS_EXTENDED: 'Перед домом',    // комментарий к адресу
            ADDRESS_COORDINATES: '55.75916251059246,37.62138180426003', // координаты
            PUBLIC: 'N'                         // пусть жалобу увидят все? Y = да, всё остальное = нет
        }

        // список обязательных полей: TEXT, POET, AUTHOR_NAME, AUTHOR_EMAIL, ADDRESS
        // если их не заполнить - жалоба сохранена не будет
        // все остальные поля можно не заполнять (на бэкенде их содержимое не проверяется)

        // теперь отправляем жалобу в бэкенд на сохранение
        // первый аргумент - объект жалобы
        // второй - callback, который выстрелит, когда бэкенд обработает ответ
        // callback должен принимать 1 параметр, в нем содержится ответ сервера в JSON формате
        backender.savePetition(petition, function (result) {

            // в этом примере просто выводим ответ сервера в консоль,
            console.log(result);
            // в консоли будет что-то типа такого
            // {STATUS: "OK", MESSAGE: "Жалоба сохранена.", DATA: ""}
            // то есть если статус = OK, значит жалоба успешно сохранена
            // если при сохранении возникнет какая-то ошибка, в статусе будет значение NEOK
            // а в поле MESSAGE будет комментарий к ошибке (например, что не заполнено какое-то обязательное поле)
        });
    }

    /*
    ==================================================
        2. Пример загрузки жалоб
    ==================================================
    */

    // первое демо - просто получаем все публичные жалобы
    function demoLoadPublicPetitions() {

        // единственный аргумент - callback, который выстрелит, когда бэкенд обработает ответ
        backender.loadPetitions(function (result) {
            // в этом примере просто выводим все жалобы в консоль,
            console.log(result);
            // в консоли будет что-то типа
            // {STATUS: "OK", MESSAGE: "Жалобы загружены.", DATA: Array(1)}
            // то есть если статус = OK, значит сервер успешно отдал результат
            // если что-то пойдет не так, в статусе будет значение NEOK
            // а в поле MESSAGE будет комментарий к ошибке
            // соответственно в поле DATA лежит массив всех жалоб
            // кроме сохраненных полей там лежит поле ID = уникальный идентификатор жалобы
            // и поле TIMESTAMP = время сохранения жалобы в формате UNIXTIME
            // жалобы отсортированы от новых к старым (новые жалобы выводятся в начале)
        });
    }

    // второе демо - пример выборки с фильтром

    function demoLoadPetitionsFilter() {

        // объект с настройками выборки (фильтр)
        const filter = {
            SHOW_HIDDEN: "Y", // нужно загрузить ВСЕ жалобы, даже те, которые при создании помечались как не публичные
            LIMIT: 10,       // сколько жалоб загружать
        };
        // т.е. всего есть 2 настройки: выводить или нет не публичные жалобы, сколько жалоб выводить


        // первый аргумент всё тот же callback, который выстрелит, когда бэкенд обработает ответ
        // второй аргумент = объект с настройками фильтра
        backender.loadPetitions(function (result) {
            // просто выводим жалобы в консоль, как в предыдущем примере
            console.log(result);
        }, filter);
    }

    /*
    ==================================================
        3. Пример удаления жалобы
    ==================================================
    */

    // в рамках приложения нам эта функция не нужна
    // но она пригодится, чтобы удалить демо-жалобы
    function demoDeletePetition(id) {
        // первый аргумент = айди жалобы, которую нужно удалить
        // второй аргумент = callback, который выстрелит, когда бэкенд обработает ответ
        backender.deletePetition(id, function (result) {
            // выведем в консоль результат удаления
            console.log(result);
        });
    }

</script>

<h1>Пример взаимодействия с бэкендом</h1>
<p>Для работы с бэкендом используем объект <b>backender</b>, он описан в файле <b>backender.js</b></p>
<p>У него есть 3 метода для работы с жалобами:</p>
<ol>
    <li><b>backender.savePetition(petition, callback);</b> &ndash; сохранение жалобы в базу данных</li>
    <li><b>backender.loadPetitions(callback, filter={});</b> &ndash; загрузка жалоб из базы данных</li>
    <li><b>backender.deletePetition(id, callback);</b> &ndash; удаление жалобы из базы данных</li>
</ol>
<p>Для примера в этом файле я сделал 4 функции-обертки для этих методов, чтобы ты могла быстро вникнуть. Вот они:</p>
<ol>
    <li><b>demoAddPetition();</b> &ndash; демо сохранения жалобы</li>
    <li><b>demoLoadPublicPetitions();</b> &ndash; демо загрузки всех публичных жалоб</li>
    <li><b>demoLoadPetitionsFilter();</b> &ndash; демо загрузки 10 последних добавленных жалоб (не только публичных, но и не публичных в том числе)</li>
    <li><b>demoDeletePetition(id);</b> &ndash; демо удаления жалобы с указанным айди</li>
</ol>
<p>То есть можешь просто вызвать их в консоли и посмотреть, что будет. Также я подробно расписал всё в комментариях, но если будут вопросы - пиши :)</p>


</body>